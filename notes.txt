Sub Validate_Click()
    Dim i As Long ' Use Long instead of Integer for larger row counts
    i = 5 ' Starting row
    
    ' Array to store column headers for dynamic messaging
    Dim headers(1 To 3) As String
    headers(1) = "PHARMACY LOCATION"
    headers(2) = "INVOICE NUMBER"
    headers(3) = "DELIVERY DATE"
    
    ' Set current date (08:16 PM IST, June 30, 2025)
    Dim currentDate As Date
    currentDate = #6/30/2025 8:16:00 PM#
    
    ' Loop until all cells in the row are empty
    Do Until IsEmpty(Cells(i, 1)) And IsEmpty(Cells(i, 2)) And IsEmpty(Cells(i, 3))
        Dim hasError As Boolean
        hasError = False
        
        ' Check all required columns in one pass
        Dim j As Integer
        For j = 1 To 3
            If Not IsEmpty(Cells(i, j)) Then
                Select Case j
                    Case 1 ' Pharmacy Location
                        If Cells(i, j).Value <> "18" Then
                            MsgBox "ROW " & i & " : " & headers(j) & " must be '18'"
                            Exit Sub
                        End If
                    Case 2 ' Invoice Number
                        Dim invNum As String
                        invNum = CStr(Cells(i, j).Value)
                        If Len(invNum) <> 10 Or Not IsNumeric(invNum) Then
                            MsgBox "ROW " & i & " : " & headers(j) & " must be a 10-digit number"
                            Exit Sub
                        End If
                    Case 3 ' Delivery Date
                        Dim dateVal As Date
                        Dim cellValue As String
                        cellValue = Trim(Cells(i, j).Value)
                        
                        On Error Resume Next ' Handle potential conversion errors
                        dateVal = CDate(cellValue)
                        On Error GoTo 0 ' Reset error handling
                        
                        If Err.Number <> 0 Or Not IsDate(cellValue) Then
                            MsgBox "ROW " & i & " : " & headers(j) & " must be a valid date"
                            Exit Sub
                        Else
                            ' Check if the format is M/d/yyyy or mm/dd/yyyy
                            Dim datePattern As String
                            datePattern = "^(\d{1,2}/\d{1,2}/\d{4})$"
                            If Not cellValue Like datePattern Then
                                MsgBox "ROW " & i & " : " & headers(j) & " must be in M/d/yyyy or mm/dd/yyyy format"
                                Exit Sub
                            Else
                                ' Validate the parsed date
                                Dim formattedDate As String
                                formattedDate = Format(dateVal, "m/d/yyyy")
                                If CDate(formattedDate) <> dateVal Then
                                    MsgBox "ROW " & i & " : " & headers(j) & " must be in M/d/yyyy or mm/dd/yyyy format"
                                    Exit Sub
                                ElseIf dateVal > currentDate Then
                                    MsgBox "ROW " & i & " : " & headers(j) & " cannot be a future date"
                                    Exit Sub
                                End If
                            End If
                        End If
                End Select
            ElseIf IsEmpty(Cells(i, j)) Then
                MsgBox "ROW " & i & " : " & headers(j) & " is Empty"
                Exit Sub
            End If
        Next j
        
        i = i + 1
    Loop
    
    MsgBox "Validation Complete. You are good to go !!"
End Sub
